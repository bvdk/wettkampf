language: node_js
node_js:
  - "12"
cache: npm
services:
  - docker

branches:
  only:
    - master

env:
  - VERSION="$(npx -c 'echo "$npm_package_version"')"

before_install:
  - npm i -g npm@latest

script:
  - bash ./travis/install.sh
  - bash ./travis/build.sh
  - bash export VERSION="$(npx -c 'echo "$npm_package_version"')" && ./travis/tag.sh
  - bash export VERSION="$(npx -c 'echo "$npm_package_version"')" && ./travis/publish.sh

before_deploy:
  - bash ./travis/publish.sh
